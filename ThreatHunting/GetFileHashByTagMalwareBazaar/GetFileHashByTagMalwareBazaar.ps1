# API Endpoint
$apiEndpoint = "https://mb-api.abuse.ch/api/v1/"

$postData = @{
    query = "get_taginfo"
    tag = "DarkGate"
    limit = 500
}

# Send GET-Request to API Endpoint
$response = Invoke-RestMethod -Uri $apiEndpoint -Method Post -Body $postData

# API-Response
if ($response) {
        Write-Host "`nAPI-response recieved:"
        Write-Host $response
} else {
    Write-Host "Error."
}

# Opret en liste til at gemme sha256_hash-værdier
$sha256HashValues = @()

# Gennemgå hvert element i $response og udtræk sha256_hash-værdien
foreach ($entry in $response.data) {

    $sha256Hash = $entry.sha256_hash

    if ($null -ne $sha256Hash) {
        $sha256HashValues += $sha256Hash
    }

    $entry.sha256_hash | Out-File -FilePath "C:\Users\mikhje\Documents\Git Repos\Blue_teaming\ThreatHunting\GetFileHashByTagMalwareBazaar\sha_values.txt" -Append


    # Write-Output $sha256HashValues
}

# Vis de udtrukne sha256_hash-værdier
$sha256HashValues